<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Tracker de Parciales y TPs</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
<meta name="color-scheme" content="light dark">
<meta name="theme-color" content="#6C5CE7">
<style>
  :root{
    --bg:#f7f7fb; --card:#ffffff; --ink:#1b1c21; --muted:#6b7280; --border:#e9e9f2;
    --brand:#6C5CE7; --ok:#10b981; --bad:#ef4444; --accent:#ffd166;
    --r:18px; --shadow:0 12px 28px rgba(17,24,39,.06);
  }
  @media (prefers-color-scheme: dark){
    :root{ --bg:#0f1221; --card:#14172a; --ink:#eef1ff; --muted:#a7b0c2; --border:#242a44; --brand:#8f84ff; --accent:#f4c430 }
  }

  *{box-sizing:border-box}
  html,body{margin:0;background:var(--bg);color:var(--ink);font-family:"Poppins",system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
  /* Top bar */
  .top{
    position:sticky;top:0;z-index:20;border-bottom:1px solid var(--border);
    background:linear-gradient(180deg, rgba(108,92,231,.10), transparent), var(--card);
    backdrop-filter:saturate(130%) blur(6px);
  }
  .wrap{max-width:1100px;margin:0 auto;padding:14px 16px;display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap}
  .brand{display:flex;align-items:center;gap:10px}
  .logo{width:14px;height:14px;border-radius:50%;background:var(--brand);box-shadow:0 0 0 6px color-mix(in oklab, var(--brand) 25%, transparent)}
  h1{margin:0;font-size:20px;font-weight:800;letter-spacing:.2px}
  .actions{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  .btn{appearance:none;border:1px solid var(--border);background:var(--card);color:var(--ink);padding:10px 16px;border-radius:14px;cursor:pointer;transition:.18s;font-weight:700}
  .btn:hover{transform:translateY(-1px);box-shadow:var(--shadow)}
  .btn:active{transform:translateY(0)}
  .btn.primary{background:var(--brand);border-color:var(--brand);color:#fff}
  .chip{border:1px solid var(--border);background:var(--card);padding:8px 14px;border-radius:999px;font-weight:600;cursor:pointer}
  .chip.active{background:var(--ink);color:var(--card);border-color:var(--ink)}
  /* Layout */
  .container{max-width:1100px;margin:0 auto;padding:18px 16px}
  .grid{display:grid;grid-template-columns:1fr;gap:16px}
  @media(min-width:980px){.grid{grid-template-columns:340px 1fr}}
  .card{background:var(--card);border:1px solid var(--border);border-radius:var(--r);box-shadow:var(--shadow);padding:18px}
  .title{margin:0 0 12px 0;font-size:16px;font-weight:800}
  .label{font-size:12px;font-weight:700;color:var(--muted);letter-spacing:.2px;text-transform:uppercase}
  .input,.select{width:100%;margin-top:6px;padding:12px 14px;border:1px solid var(--border);border-radius:12px;background:#fff0;color:var(--ink)}
  .input:focus,.select:focus{outline:none;border-color:var(--brand);box-shadow:0 0 0 4px color-mix(in oklab, var(--brand) 25%, transparent)}

  /* Pills materias */
  #chips{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}

  /* Tabla responsive */
  .table{width:100%;border-collapse:separate;border-spacing:0 10px}
  .th{font-size:12px;color:var(--muted);text-transform:uppercase;text-align:left;padding:0 10px}
  .row{background:var(--card);border:1px solid var(--border);border-radius:14px;overflow:hidden}
  .cell{padding:14px 12px}
  .badge{display:inline-block;padding:5px 10px;border-radius:10px;font-weight:800;border:1px solid var(--border)}
  .tone-blue{background:color-mix(in oklab, var(--brand) 18%, transparent);border-color:color-mix(in oklab, var(--brand) 45%, transparent)}
  .tone-green{background:color-mix(in oklab, var(--ok) 18%, transparent);border-color:color-mix(in oklab, var(--ok) 45%, transparent)}
  .tone-amber{background:color-mix(in oklab, var(--accent) 28%, transparent);border-color:color-mix(in oklab, var(--accent) 55%, transparent)}
  .tone-red{background:color-mix(in oklab, var(--bad) 18%, transparent);border-color:color-mix(in oklab, var(--bad) 45%, transparent)}
  .ok{color:var(--ok);font-weight:800}
  .bad{color:var(--bad);font-weight:800}

  /* Responsive stack */
  @media(max-width:720px){
    .th.hide-m,.cell.hide-m{display:none}
    .table{border-spacing:0 8px}
    .cell{padding:12px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:6px}
    .row .cell:first-child{grid-column:1/-1}
  }

  /* Toast */
  .toast{position:fixed;inset:auto 16px 16px auto;background:var(--ink);color:var(--card);
    padding:10px 14px;border-radius:12px;font-weight:700;opacity:0;transform:translateY(10px);
    transition:.25s;pointer-events:none}
  .toast.show{opacity:1;transform:translateY(0)}
</style>
</head>
<body>
  <div class="top">
    <div class="wrap">
      <div class="brand"><span class="logo"></span><h1>Tracker de Parciales y TPs</h1></div>
      <div class="actions">
        <button id="btnLight" class="btn">Claro</button>
        <button id="btnDark" class="btn">Oscuro</button>
        <button id="btnGuardar" class="btn primary">Guardar cambios</button>
      </div>
    </div>
  </div>

  <main class="container">
    <div class="grid">
      <!-- Col izquierda -->
      <aside class="card">
        <p class="title">Materias</p>
        <label class="label">Nueva materia</label>
        <div style="display:grid;grid-template-columns:1fr auto;gap:10px">
          <input id="materiaNueva" class="input" placeholder="Ej: Matemática">
          <button id="btnCrearMateria" class="btn">Crear</button>
        </div>

        <div id="chips"></div>

        <div id="editBox" style="display:none;margin-top:14px">
          <label class="label">Editar</label>
          <div style="display:grid;grid-template-columns:1fr auto auto;gap:8px;margin-top:6px">
            <input id="materiaEdit" class="input" placeholder="Renombrar">
            <button id="btnRenombrar" class="btn">Renombrar</button>
            <button id="btnBorrar" class="btn" style="border-color:#ffd4d4;color:#c24141">Borrar</button>
          </div>
        </div>
      </aside>

      <!-- Col derecha -->
      <section class="card">
        <p class="title">Agregar parcial / TP</p>
        <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px">
          <div><label class="label">Materia</label><select id="itMateria" class="select"></select></div>
          <div><label class="label">Título</label><input id="itTitulo" class="input" placeholder="Ej: Parcial 1"></div>
          <div><label class="label">Tipo</label><select id="itTipo" class="select"><option>Parcial</option><option>TP</option><option>Otro</option></select></div>
          <div><label class="label">Fecha</label><input id="itFecha" type="date" class="input"></div>
          <div><label class="label">Calificación</label><select id="itCalif" class="select"><option value="">—</option><option value="aprobado">Aprobado</option><option value="desaprobado">Desaprobado</option></select></div>
          <div><label class="label">Estado</label><select id="itEstado" class="select"><option value="pendiente">Pendiente</option><option value="entregado">Entregado</option><option value="corregido">Corregido</option></select></div>
        </div>
        <div style="display:flex;justify-content:flex-end;margin-top:10px">
          <button id="btnAgregar" class="btn">Agregar</button>
        </div>
      </section>
    </div>

    <section class="card" style="margin-top:12px">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
        <p class="title" style="margin:0">Listado</p>
        <div id="contador" class="label" style="text-transform:none"></div>
      </div>

      <div class="table">
        <div style="display:grid;grid-template-columns:2fr 1fr 1fr 1fr 1fr;gap:6px;margin:0 0 6px 0">
          <div class="th">Título • Materia • Tipo</div>
          <div class="th">Fecha</div>
          <div class="th hide-m">Calificación</div>
          <div class="th">Estado</div>
          <div class="th">Resultado</div>
        </div>
        <div id="lista"></div>
      </div>
    </section>
  </main>

  <div id="toast" class="toast">Guardado ✅</div>

<script>
/* ===== Estado ===== */
const LSK="tracker-ui-nuevo-v1";
const $=s=>document.querySelector(s);
const state={materias:[], items:[], ui:{materiaActiva:"all"}};
function uid(){return Math.random().toString(36).slice(2,10)+Date.now().toString(36).slice(-4);}

/* ===== Persistencia manual ===== */
function save(){ localStorage.setItem(LSK, JSON.stringify({materias:state.materias, items:state.items})); }
function load(){
  try{ const raw=localStorage.getItem(LSK); if(raw){ const d=JSON.parse(raw); state.materias=d.materias||[]; state.items=d.items||[]; } }
  catch{}
}
function toast(msg="Guardado ✅"){ const t=$("#toast"); t.textContent=msg; t.classList.add("show"); setTimeout(()=>t.classList.remove("show"), 1800); }

/* ===== Render ===== */
function chip(label,active,on){const b=document.createElement("button");b.className="chip"+(active?" active":"");b.textContent=label;b.onclick=on;return b;}
function getMateria(id){return state.materias.find(m=>m.id===id)}
function tone(item){
  if(item.estado==="corregido") return "tone-green";
  if(item.estado==="entregado") return "tone-blue";
  return "tone-amber";
}
function renderMaterias(){
  const box=$("#chips"); box.innerHTML="";
  box.appendChild(chip("Todas", state.ui.materiaActiva==="all", ()=>{state.ui.materiaActiva="all"; render()}));
  state.materias.forEach(m=> box.appendChild(chip(m.nombre, state.ui.materiaActiva===m.id, ()=>{state.ui.materiaActiva=m.id; render()})));
  const edit=$("#editBox");
  if(state.ui.materiaActiva!=="all"){ edit.style.display="block"; $("#materiaEdit").value=getMateria(state.ui.materiaActiva)?.nombre||""; }
  else edit.style.display="none";
}
function renderSelect(){
  const sel=$("#itMateria"); sel.innerHTML="";
  if(!state.materias.length){ sel.disabled=true; sel.innerHTML='<option>— Primero creá una materia —</option>'; }
  else{
    sel.disabled=false;
    state.materias.forEach(m=>{const o=document.createElement("option");o.value=m.id;o.textContent=m.nombre;sel.appendChild(o);});
    if(state.ui.materiaActiva!=="all") sel.value=state.ui.materiaActiva;
  }
}
function renderLista(){
  const wrap=$("#lista"); wrap.innerHTML="";
  const cnt=$("#contador");
  let arr=state.items.slice();
  if(state.ui.materiaActiva!=="all") arr=arr.filter(i=>i.materiaId===state.ui.materiaActiva);
  cnt.textContent = arr.length+" ítem(s)";

  if(!arr.length){ wrap.innerHTML='<div class="label" style="text-transform:none;color:var(--muted)">No hay ítems aún.</div>'; return; }

  arr.sort((a,b)=> new Date(a.fechaISO)-new Date(b.fechaISO));
  arr.forEach(it=>{
    const tr=document.createElement("div");
    tr.className="row";
    tr.style.display="grid";
    tr.style.gridTemplateColumns="2fr 1fr 1fr 1fr 1fr";
    tr.style.gap="6px";

    const fecha=new Date(it.fechaISO+"T00:00:00").toLocaleDateString();
    const calTxt = it.calif ? (it.calif==="aprobado"?"Aprobado":"Desaprobado") : "—";
    const calCls = it.calif==="aprobado"?"ok": it.calif==="desaprobado"?"bad":"";

    tr.innerHTML = `
      <div class="cell">
        <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
          <span class="badge ${tone(it)}">${it.estado}</span>
          <strong>${escapeHtml(it.titulo)}</strong>
        </div>
        <div class="label" style="text-transform:none">${escapeHtml(getMateria(it.materiaId)?.nombre||"—")} • ${escapeHtml(it.tipo)}</div>
      </div>
      <div class="cell">${fecha}</div>
      <div class="cell hide-m ${calCls}">${calTxt}</div>
      <div class="cell">
        <select data-act="estado" data-id="${it.id}" class="select">
          <option value="pendiente" ${it.estado==='pendiente'?'selected':''}>Pendiente</option>
          <option value="entregado" ${it.estado==='entregado'?'selected':''}>Entregado</option>
          <option value="corregido" ${it.estado==='corregido'?'selected':''}>Corregido</option>
        </select>
      </div>
      <div class="cell">
        <select data-act="calif" data-id="${it.id}" class="select">
          <option value="" ${!it.calif?'selected':''}>—</option>
          <option value="aprobado" ${it.calif==='aprobado'?'selected':''}>Aprobado</option>
          <option value="desaprobado" ${it.calif==='desaprobado'?'selected':''}>Desaprobado</option>
        </select>
      </div>
    `;
    wrap.appendChild(tr);
  });

  // listeners
  wrap.querySelectorAll("select[data-act='estado']").forEach(s=>{
    s.onchange = e=>{
      const it = state.items.find(x=>x.id===e.target.dataset.id);
      if(it){ it.estado = e.target.value; renderLista(); }
    }
  });
  wrap.querySelectorAll("select[data-act='calif']").forEach(s=>{
    s.onchange = e=>{
      const it = state.items.find(x=>x.id===e.target.dataset.id);
      if(it){ it.calif = e.target.value || null; renderLista(); }
    }
  });
}
function render(){ renderMaterias(); renderSelect(); renderLista(); }

/* ===== Acciones ===== */
$("#btnCrearMateria").onclick=()=>{
  const v=$("#materiaNueva").value.trim(); if(!v) return;
  const m={id:uid(), nombre:v}; state.materias.push(m); state.ui.materiaActiva=m.id;
  $("#materiaNueva").value=""; render();
};
$("#btnRenombrar").onclick=()=>{
  if(state.ui.materiaActiva==="all") return;
  const m=getMateria(state.ui.materiaActiva); if(!m) return;
  const v=$("#materiaEdit").value.trim(); if(!v) return;
  m.nombre=v; render();
};
$("#btnBorrar").onclick=()=>{
  if(state.ui.materiaActiva==="all") return;
  const id=state.ui.materiaActiva;
  state.materias = state.materias.filter(m=>m.id!==id);
  state.items    = state.items.filter(i=>i.materiaId!==id);
  state.ui.materiaActiva="all"; render();
};
$("#btnAgregar").onclick=()=>{
  const materiaId=$("#itMateria").value, titulo=$("#itTitulo").value.trim(),
        tipo=$("#itTipo").value, fechaISO=$("#itFecha").value,
        calif=$("#itCalif").value||null, estado=$("#itEstado").value;
  if(!materiaId || !titulo || !fechaISO){ alert("Completá Materia, Título y Fecha."); return; }
  state.items.push({id:uid(), materiaId, titulo, tipo, fechaISO, calif, estado});
  $("#itTitulo").value=""; $("#itCalif").value="";
  render();
};
$("#btnGuardar").onclick=()=>{ save(); toast(); };

/* Tema */
const html=document.documentElement;
$("#btnLight").onclick=()=>{ html.setAttribute("data-theme","light"); };
$("#btnDark").onclick =()=>{ html.setAttribute("data-theme","dark"); };

/* Helpers */
function escapeHtml(s){return String(s).replace(/[&<>"']/g, ch=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[ch]||ch));}

/* Init */
load();
$("#itFecha").value = new Date().toISOString().slice(0,10);
render();
</script>
</body>
</html>
